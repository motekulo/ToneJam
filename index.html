<!doctype html>
<html>
	<head>
		<title>ToneJam</title>
		<script src="js/jquery.js"></script>
		<script src="js/jquery-ui.min.js"></script>
		<script src="js/nexusUI.js"></script>
		<script src="js/Tone4.js"></script>
		<script src="js/rack.js"></script>
		<link href="css/style.css" rel="stylesheet" type="text/css"></link>
	</head>
	<body>

		<script>

			nx.onload = function() {
				nx.colorize("#0c7");
			//	ghost1.watch();
				nx.toDB = function(signal) {
					var DB = nx.scale(signal,0,1,-96,5)
					console.log(DB)
					return DB;
				}
			}

			$(function() {
				$(".dragitem").draggable({
					helper: "clone"
					//drag: function() {}
				})
				$(".dropzone").droppable({
				//	hoverClass: "rack-hover",
					over: function(event,ui) {
						if (ui.draggable[0].className.indexOf("ugen")>=0) {
							$(this).find(".emptyugen").css("border-style", "solid")
						} else {
							$(this).find(".emptyfx").css("border-style", "solid")
						}
					},
					out: function(event,ui) {
						$(this).find(".emptyrack").css("border-style", "dashed")
					},
					drop: function( event, ui ) {
						addRack(ui.draggable[0].innerHTML,$(this).find("#racks")[0])
						if (ui.draggable[0].className.indexOf("ugen")>=0) {
			       			$(this).find(".emptyugen").hide()
			       		} else {
			       			$(this).find(".emptyugen").hide()
			       		}
			        }
				})
			})


			var dir = "audio/";
			var fileextension = ".mp3";
			$.ajax({
			    url: dir,
			    success: function (data) {
			        $(data).find("a:contains('" + fileextension + "')").each(function () {
			        		var file = this.href
			        		file = file.split("/")
			        		media.push(file[file.length-1])
			        });
			    }
			});






		</script>

		<div id="dragzone">

			<script>

				var pcount = 0;

				for (var key in Parts) {
					var cl = (pcount<8) ? "dragitem ugen" : "dragitem fx";
					document.write('<div class="'+cl+'">'+key+'</div>')
					pcount++
				}

			</script>

		</div>

		<header>ToneJam : An improvisational controller for Tone.js + NexusUI</header>

		<div class="dropzone" id="dropzone1">

			<div id="racks"></div>

			<div class="emptyrack emptyugen">
				Signals
			</div>

			<div class="emptyrack emptyfx">
				FX
			</div>

		</div>

		<div class="dropzone" id="dropzone2">

			<div id="racks"></div>

			<div class="emptyrack">
			</div>

		</div>
		
<!--
		<canvas nx="ghost" style="position:fixed;bottom:0px;right:0px"></canvas> -->

	</body>
</html>